{"ast":null,"code":"var _jsxFileName = \"/Users/sydneysonday/Desktop/Senior/Reading Front End/senior-project/proj/src/components/BookReader.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { auth, saveHighlight, removeHighlight, getHighlights } from '../services/firebase';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst BookReader = () => {\n  _s();\n  const {\n    bookTitle\n  } = useParams();\n  const [highlights, setHighlights] = useState([]);\n  const [selectedText, setSelectedText] = useState('');\n  const [error, setError] = useState('');\n\n  // Load highlights when component mounts\n  useEffect(() => {\n    loadHighlights();\n  }, [bookTitle]);\n  const loadHighlights = async () => {\n    if (!auth.currentUser) return;\n    const {\n      highlights: savedHighlights,\n      error\n    } = await getHighlights(auth.currentUser.uid, bookTitle);\n    if (error) {\n      setError('Failed to load highlights');\n      return;\n    }\n    setHighlights(savedHighlights || []);\n    applyHighlights(savedHighlights);\n  };\n  const handleTextSelection = async () => {\n    const selection = window.getSelection();\n    const selectedText = selection.toString().trim();\n    if (!selectedText || !auth.currentUser) return;\n    const range = selection.getRangeAt(0);\n    const startContainer = range.startContainer;\n    const startOffset = range.startOffset;\n    const endContainer = range.endContainer;\n    const endOffset = range.endOffset;\n\n    // Create highlight object\n    const highlight = {\n      text: selectedText,\n      startPath: getNodePath(startContainer),\n      startOffset,\n      endPath: getNodePath(endContainer),\n      endOffset,\n      timestamp: new Date().toISOString()\n    };\n    try {\n      const {\n        error\n      } = await saveHighlight(auth.currentUser.uid, bookTitle, highlight);\n      if (error) {\n        setError('Failed to save highlight');\n        return;\n      }\n      setHighlights([...highlights, highlight]);\n      applyHighlight(highlight);\n    } catch (err) {\n      setError('Failed to save highlight');\n    }\n  };\n\n  // Helper function to get DOM path to a node\n  const getNodePath = node => {\n    const path = [];\n    let current = node;\n    while (current.parentNode) {\n      const index = Array.from(current.parentNode.childNodes).indexOf(current);\n      path.unshift(index);\n      current = current.parentNode;\n    }\n    return path;\n  };\n\n  // Helper function to get node from path\n  const getNodeFromPath = path => {\n    let current = document.body;\n    for (const index of path) {\n      current = current.childNodes[index];\n    }\n    return current;\n  };\n\n  // Apply a single highlight\n  const applyHighlight = highlight => {\n    try {\n      const startNode = getNodeFromPath(highlight.startPath);\n      const endNode = getNodeFromPath(highlight.endPath);\n      const range = document.createRange();\n      range.setStart(startNode, highlight.startOffset);\n      range.setEnd(endNode, highlight.endOffset);\n      const span = document.createElement('span');\n      span.className = 'highlighted-text';\n      span.dataset.timestamp = highlight.timestamp;\n      range.surroundContents(span);\n    } catch (err) {\n      console.error('Failed to apply highlight:', err);\n    }\n  };\n\n  // Apply all highlights\n  const applyHighlights = highlightsToApply => {\n    // Remove existing highlights first\n    document.querySelectorAll('.highlighted-text').forEach(el => {\n      const parent = el.parentNode;\n      while (el.firstChild) parent.insertBefore(el.firstChild, el);\n      parent.removeChild(el);\n    });\n\n    // Apply new highlights\n    highlightsToApply.forEach(highlight => applyHighlight(highlight));\n  };\n\n  // Handle removing a highlight\n  const handleRemoveHighlight = async event => {\n    if (!event.target.classList.contains('highlighted-text')) return;\n    const timestamp = event.target.dataset.timestamp;\n    const highlightToRemove = highlights.find(h => h.timestamp === timestamp);\n    if (!highlightToRemove || !auth.currentUser) return;\n    try {\n      const {\n        error\n      } = await removeHighlight(auth.currentUser.uid, bookTitle, highlightToRemove);\n      if (error) {\n        setError('Failed to remove highlight');\n        return;\n      }\n      setHighlights(highlights.filter(h => h.timestamp !== timestamp));\n\n      // Remove highlight span\n      const parent = event.target.parentNode;\n      while (event.target.firstChild) {\n        parent.insertBefore(event.target.firstChild, event.target);\n      }\n      parent.removeChild(event.target);\n    } catch (err) {\n      setError('Failed to remove highlight');\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"book-reader\",\n    children: [error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"error-message\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"book-content\",\n      onMouseUp: handleTextSelection,\n      onClick: handleRemoveHighlight\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 166,\n    columnNumber: 5\n  }, this);\n};\n_s(BookReader, \"6TxzHjwTCv/rcYK3muXWhSZlqQc=\", false, function () {\n  return [useParams];\n});\n_c = BookReader;\nexport default BookReader;\nvar _c;\n$RefreshReg$(_c, \"BookReader\");","map":{"version":3,"names":["React","useState","useEffect","useParams","auth","saveHighlight","removeHighlight","getHighlights","jsxDEV","_jsxDEV","BookReader","_s","bookTitle","highlights","setHighlights","selectedText","setSelectedText","error","setError","loadHighlights","currentUser","savedHighlights","uid","applyHighlights","handleTextSelection","selection","window","getSelection","toString","trim","range","getRangeAt","startContainer","startOffset","endContainer","endOffset","highlight","text","startPath","getNodePath","endPath","timestamp","Date","toISOString","applyHighlight","err","node","path","current","parentNode","index","Array","from","childNodes","indexOf","unshift","getNodeFromPath","document","body","startNode","endNode","createRange","setStart","setEnd","span","createElement","className","dataset","surroundContents","console","highlightsToApply","querySelectorAll","forEach","el","parent","firstChild","insertBefore","removeChild","handleRemoveHighlight","event","target","classList","contains","highlightToRemove","find","h","filter","children","fileName","_jsxFileName","lineNumber","columnNumber","onMouseUp","onClick","_c","$RefreshReg$"],"sources":["/Users/sydneysonday/Desktop/Senior/Reading Front End/senior-project/proj/src/components/BookReader.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { auth, saveHighlight, removeHighlight, getHighlights } from '../services/firebase';\n\nconst BookReader = () => {\n  const { bookTitle } = useParams();\n  const [highlights, setHighlights] = useState([]);\n  const [selectedText, setSelectedText] = useState('');\n  const [error, setError] = useState('');\n  \n  // Load highlights when component mounts\n  useEffect(() => {\n    loadHighlights();\n  }, [bookTitle]);\n\n  const loadHighlights = async () => {\n    if (!auth.currentUser) return;\n\n    const { highlights: savedHighlights, error } = await getHighlights(\n      auth.currentUser.uid,\n      bookTitle\n    );\n\n    if (error) {\n      setError('Failed to load highlights');\n      return;\n    }\n\n    setHighlights(savedHighlights || []);\n    applyHighlights(savedHighlights);\n  };\n\n  const handleTextSelection = async () => {\n    const selection = window.getSelection();\n    const selectedText = selection.toString().trim();\n\n    if (!selectedText || !auth.currentUser) return;\n\n    const range = selection.getRangeAt(0);\n    const startContainer = range.startContainer;\n    const startOffset = range.startOffset;\n    const endContainer = range.endContainer;\n    const endOffset = range.endOffset;\n\n    // Create highlight object\n    const highlight = {\n      text: selectedText,\n      startPath: getNodePath(startContainer),\n      startOffset,\n      endPath: getNodePath(endContainer),\n      endOffset,\n      timestamp: new Date().toISOString(),\n    };\n\n    try {\n      const { error } = await saveHighlight(\n        auth.currentUser.uid,\n        bookTitle,\n        highlight\n      );\n\n      if (error) {\n        setError('Failed to save highlight');\n        return;\n      }\n\n      setHighlights([...highlights, highlight]);\n      applyHighlight(highlight);\n    } catch (err) {\n      setError('Failed to save highlight');\n    }\n  };\n\n  // Helper function to get DOM path to a node\n  const getNodePath = (node) => {\n    const path = [];\n    let current = node;\n    \n    while (current.parentNode) {\n      const index = Array.from(current.parentNode.childNodes).indexOf(current);\n      path.unshift(index);\n      current = current.parentNode;\n    }\n    \n    return path;\n  };\n\n  // Helper function to get node from path\n  const getNodeFromPath = (path) => {\n    let current = document.body;\n    \n    for (const index of path) {\n      current = current.childNodes[index];\n    }\n    \n    return current;\n  };\n\n  // Apply a single highlight\n  const applyHighlight = (highlight) => {\n    try {\n      const startNode = getNodeFromPath(highlight.startPath);\n      const endNode = getNodeFromPath(highlight.endPath);\n      \n      const range = document.createRange();\n      range.setStart(startNode, highlight.startOffset);\n      range.setEnd(endNode, highlight.endOffset);\n      \n      const span = document.createElement('span');\n      span.className = 'highlighted-text';\n      span.dataset.timestamp = highlight.timestamp;\n      range.surroundContents(span);\n    } catch (err) {\n      console.error('Failed to apply highlight:', err);\n    }\n  };\n\n  // Apply all highlights\n  const applyHighlights = (highlightsToApply) => {\n    // Remove existing highlights first\n    document.querySelectorAll('.highlighted-text').forEach(el => {\n      const parent = el.parentNode;\n      while (el.firstChild) parent.insertBefore(el.firstChild, el);\n      parent.removeChild(el);\n    });\n\n    // Apply new highlights\n    highlightsToApply.forEach(highlight => applyHighlight(highlight));\n  };\n\n  // Handle removing a highlight\n  const handleRemoveHighlight = async (event) => {\n    if (!event.target.classList.contains('highlighted-text')) return;\n    \n    const timestamp = event.target.dataset.timestamp;\n    const highlightToRemove = highlights.find(h => h.timestamp === timestamp);\n    \n    if (!highlightToRemove || !auth.currentUser) return;\n\n    try {\n      const { error } = await removeHighlight(\n        auth.currentUser.uid,\n        bookTitle,\n        highlightToRemove\n      );\n\n      if (error) {\n        setError('Failed to remove highlight');\n        return;\n      }\n\n      setHighlights(highlights.filter(h => h.timestamp !== timestamp));\n      \n      // Remove highlight span\n      const parent = event.target.parentNode;\n      while (event.target.firstChild) {\n        parent.insertBefore(event.target.firstChild, event.target);\n      }\n      parent.removeChild(event.target);\n    } catch (err) {\n      setError('Failed to remove highlight');\n    }\n  };\n\n  return (\n    <div className=\"book-reader\">\n      {error && <div className=\"error-message\">{error}</div>}\n      <div \n        className=\"book-content\"\n        onMouseUp={handleTextSelection}\n        onClick={handleRemoveHighlight}\n      >\n        {/* Your book content here */}\n      </div>\n    </div>\n  );\n};\n\nexport default BookReader;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}